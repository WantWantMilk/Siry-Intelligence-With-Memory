<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Siry - å…¼å®¹æ¨¡å¼</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background: #f0f0f0; }
        #chatBox { border: 1px solid #999; height: 400px; overflow-y: scroll; padding: 10px; background: white; margin-bottom: 10px; }
        .userMsg { text-align: right; color: blue; margin: 5px; background: #e3f2fd; padding: 8px; border-radius: 10px; display: inline-block; max-width: 80%; float: right; clear: both; }
        .botMsg { text-align: left; color: green; margin: 5px; background: #f1f8e9; padding: 8px; border-radius: 10px; display: inline-block; max-width: 80%; float: left; clear: both; }
        input { width: 70%; padding: 12px; font-size: 16px; border: 2px solid #ccc; border-radius: 5px; }
        button { padding: 12px 24px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .info { color: #666; margin: 10px 0; font-size: 0.9em; }
    </style>
</head>
<body>
    <h2>ğŸ¤– Siry èŠå¤©å®¤ (å…¼å®¹æ¨¡å¼)</h2>
    <p class="info"><strong>æ³¨æ„ï¼š</strong>æ­¤é¡µé¢ä¸ºæ—§ç‰ˆæµè§ˆå™¨ä¼˜åŒ–ï¼Œ<strong>åŒæ ·å…·å¤‡å®Œæ•´è®°å¿†åŠŸèƒ½</strong>ã€‚</p>
    
    <div id="chatBox">
        <div class="botMsg"><strong>Siry:</strong> ä½ å¥½ï¼æˆ‘å·²è¿›å…¥å…¼å®¹æ¨¡å¼ï¼Œèƒ½è®°ä½æˆ‘ä»¬ä¹‹å‰çš„å¯¹è¯ã€‚</div>
    </div>
    
    <input type="text" id="userInput" placeholder="è¾“å…¥æ¶ˆæ¯...">
    <button onclick="sendMessage()">å‘é€</button>
    
    <p class="info">
        <a href="index.html">â† è¿”å›ä¸»ç•Œé¢</a> | 
        è®°å¿†å·²å¯ç”¨ | 
        <button onclick="clearMemory()" style="padding:5px 10px; font-size:0.8em;">æ¸…ç©ºè®°å¿†</button>
    </p>

    <!-- å¼•ç”¨ç›¸åŒçš„æ ¸å¿ƒæ–‡ä»¶ -->
    <script src="siry-core.js"></script>
    
    <script>
        // åˆå§‹åŒ–æ˜¾ç¤º
        function initDisplay() {
            const recent = window.SiryCore.memory.getRecentMessages(5);
            const chatBox = document.getElementById('chatBox');
            
            recent.forEach(msg => {
                const div = document.createElement('div');
                div.className = msg.role === 'user' ? 'userMsg' : 'botMsg';
                div.innerHTML = `<strong>${msg.role === 'user' ? 'ä½ ' : 'Siry'}:</strong> ${msg.content}`;
                chatBox.appendChild(div);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const chatBox = document.getElementById('chatBox');
            const msg = input.value.trim();
            
            if (!msg) return;
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            const userDiv = document.createElement('div');
            userDiv.className = 'userMsg';
            userDiv.innerHTML = `<strong>ä½ :</strong> ${msg}`;
            chatBox.appendChild(userDiv);
            
            // æ˜¾ç¤ºæ€è€ƒä¸­
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'botMsg';
            thinkingDiv.innerHTML = `<strong>Siry:</strong> æ€è€ƒä¸­...`;
            chatBox.appendChild(thinkingDiv);
            
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;
            
            // ä½¿ç”¨æ ¸å¿ƒåº“å‘é€æ¶ˆæ¯
            await window.SiryCore.sendToSiry(msg, (reply) => {
                // æ›¿æ¢æ€è€ƒä¸­æ¶ˆæ¯
                thinkingDiv.innerHTML = `<strong>Siry:</strong> ${reply}`;
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }
        
        // æ¸…ç©ºè®°å¿†
        function clearMemory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¯¹è¯è®°å¿†å—ï¼Ÿ')) {
                window.SiryCore.memory.clear();
                alert('è®°å¿†å·²æ¸…ç©ºï¼é¡µé¢å°†åˆ·æ–°ã€‚');
                location.reload();
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            initDisplay();
            // å›è½¦é”®å‘é€
            document.getElementById('userInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
        });
    </script>
</body>
</html>